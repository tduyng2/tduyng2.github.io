<!doctype html><html lang=en><head><meta charset=utf-8><meta content=dark name=color-scheme><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://tduyng2.github.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><meta content="index, nofollow" name=robots><meta content="Discover the advantages and reasons behind utilizing Docker Compose for managing multi-container Docker applications." name=description><title>Why use Docker compose</title><link href=/img/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/img/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/img/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><meta content="Why use Docker compose" property=og:title><meta content=article property=og:type><meta content="Duy NG" property=og:site_name><meta content="Discover the advantages and reasons behind utilizing Docker Compose for managing multi-container Docker applications." name=description><meta content="Discover the advantages and reasons behind utilizing Docker Compose for managing multi-container Docker applications." property=og:description><meta content="https://tduyng2.github.io/img/avatar.webp?h=742e6e00a4c9ec8e8fc2" property=og:image><meta content=736 property=og:image:width><meta content=736 property=og:image:height><meta content="https://tduyng2.github.io/img/avatar.webp?h=742e6e00a4c9ec8e8fc2" name=twitter:image><meta content=summary_large_image name=twitter:card><style>body{--primary-color:#5871a2;--primary-pale-color:#5871a210;--text-color:#3c4043;--text-pale-color:#94969f;--bg-color:#fff;--highlight-mark-color:#5f75b035;--callout-note-color:#5871a2;--callout-important-color:#8062b0;--callout-warning-color:#936e51;--callout-alert-color:#bc5252;--callout-question-color:#477389;--callout-tip-color:#3c8460}body.dark{--primary-color:#447dbf;--primary-pale-color:#5d77ac20;--text-color:#a5abba;--text-pale-color:#a5abba;--bg-color:#202124;--highlight-mark-color:#5f75b035;--callout-note-color:#5d77ac;--callout-important-color:#8062b0;--callout-warning-color:#936e51;--callout-alert-color:#bc5252;--callout-question-color:#477389;--callout-tip-color:#3c8460}body{--main-font:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--code-font:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--homepage-max-width:768px;--main-max-width:768px;--avatar-size:60px;--icon-size:20px;--homepage-font-size:16px;--homepage-line-height:1.75;--paragraph-font-size:16px;--paragraph-line-height:1.75;--aside-font-size:15px;--img-border-radius:0px;--callout-border-radius:0px;--detail-border-radius:0px;--dark-mode-img-brightness:.75;--dark-mode-chart-brightness:.75;--inline-code-border-radius:2px;--inline-code-bg-color:var(--primary-pale-color);--block-code-border-radius:0px;--block-code-border-color:var(--primary-color);--detail-border-color:var(--primary-color)}</style><link href=/main.css rel=stylesheet><script async data-do-not-track=true data-website-id=0403ec1f-fbf8-4e6c-b24b-0c585ca25873 defer src=https://analytics.eu.umami.is/script.js></script><body class=post><script>const theme=sessionStorage.getItem(`theme`);const match=window.matchMedia(`(prefers-color-scheme: dark)`).matches;if(theme&&theme==`dark`||!theme&&match){document.body.classList.add(`dark`);const a=document.querySelector(`link#hl`);if(a)a.href=`/hl-dark.css`}</script><header class=blur><div id=header-wrapper><nav><a class=instant href=/>tduyng</a><button aria-label="toggle expand" class=separator id=toggler>::</button><span class="wrap left fold">{</span><a class=instant href=/blog>blog</a><span class="wrap-separator fold">,</span><a class="instant fold" href=/projects>projects</a><span class="wrap-separator fold">,</span><a class="instant fold" href=/about>about</a><span class="wrap right fold">} ;</span></nav><div id=btns><a aria-label="rss feed" href=/atom.xml id=rss-btn><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M3 17C5.20914 17 7 18.7909 7 21H3V17ZM3 10C9.07513 10 14 14.9249 14 21H12C12 16.0294 7.97056 12 3 12V10ZM3 3C12.9411 3 21 11.0589 21 21H19C19 12.1634 11.8366 5 3 5V3Z" fill=currentColor></path></svg></a><button aria-label="table of content" id=toc-toggle><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M3 4H21V6H3V4ZM3 11H15V13H3V11ZM3 18H21V20H3V18Z" fill=currentColor></path></svg></button></div></div></header><dialog id=rss-mask><div><a href=https://tduyng2.github.io/atom.xml>https://tduyng2.github.io/atom.xml</a><button data-check-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z" fill="currentColor"></path></svg>' data-copy-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>' aria-label=copy autofocus data-link=https://tduyng2.github.io/atom.xml><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill=currentColor></path></svg></button></div></dialog><div id=wrapper><div id=blank></div><aside><nav><ul><li><a class=h2 href=#what-is-docker-compose>What is Docker compose?</a><li><a class=h2 href=#project-demo>Project demo</a> <ul><li><a class=h3 href=#installation>Installation</a><li><a class=h3 href=#create-docker-images-without-docker-compose>Create Docker Images without Docker compose</a><li><a class=h3 href=#create-docker-image-using-docker-compose>Create Docker image using Docker compose</a></ul><li><a class=h2 href=#resume>Resume</a><li><a class=h2 href=#reference>Reference</a></ul></nav><button aria-label="back to top" id=back-to-top><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M11.9997 10.8284L7.04996 15.7782L5.63574 14.364L11.9997 8L18.3637 14.364L16.9495 15.7782L11.9997 10.8284Z" fill=currentColor></path></svg></button></aside><main><div><div data-check-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z" fill="currentColor"></path></svg>' data-copy-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>' id=copy-cfg style=display:none></div><article data-backlink-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M9.41421 8L18.0208 16.6066L16.6066 18.0208L8 9.41421V17H6V6H17V8H9.41421Z" fill="currentColor"></path></svg>' class=prose><h1>Why use Docker compose</h1><div id=post-info><div id=date><span id=publish>2021-01-25</span></div><div id=tags><a class=instant href=https://tduyng2.github.io/tags/docker><span>#</span>docker</a><a class=instant href=https://tduyng2.github.io/tags/compose><span>#</span>compose</a></div></div><blockquote class="callout alert hidden" data-alert-text-after=" days ago and may be out of date." data-alert-text-before="This article was last updated " data-days=365 id=outdate_alert><div class=icon><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M4.00098 20V14C4.00098 9.58172 7.5827 6 12.001 6C16.4193 6 20.001 9.58172 20.001 14V20H21.001V22H3.00098V20H4.00098ZM6.00098 20H18.001V14C18.001 10.6863 15.3147 8 12.001 8C8.68727 8 6.00098 10.6863 6.00098 14V20ZM11.001 2H13.001V5H11.001V2ZM19.7792 4.80761L21.1934 6.22183L19.0721 8.34315L17.6578 6.92893L19.7792 4.80761ZM2.80859 6.22183L4.22281 4.80761L6.34413 6.92893L4.92991 8.34315L2.80859 6.22183ZM7.00098 14C7.00098 11.2386 9.23956 9 12.001 9V11C10.3441 11 9.00098 12.3431 9.00098 14H7.00098Z" fill=currentColor></path></svg></div><div class=content></div></blockquote><h2 id=what-is-docker-compose>What is <strong>Docker compose</strong>?<a aria-label="Anchor link for: what-is-docker-compose" class=zola-anchor href=#what-is-docker-compose style=visibility:hidden>#</a></h2><p>If you read this article, I think you maybe already understand what is <a rel="nofollow noreferrer" href=https://www.docker.com/why-docker>Docker</a>.<p>Docker is a tool which helps to create, deploy, and run applications by using containers. Docker provides developers and operators with a friendly interface to build, ship, and run containers on any environment.<p>With the docker-cli, we can run and execute the Docker container via <a href="https://docs.docker.com/engine/reference/builder/#:~:text=A%20Dockerfile%20is%20a%20text,can%20use%20in%20a%20Dockerfile%20." rel="nofollow noreferrer">Dockerfile</a>. But with Dockerfile, we can work only with a container, but in the project, we normally work with multiple containers. In that case, we need to use <strong>Docker compose</strong>.<p><strong>Docker Compose</strong> define the services that make up your app in <code>docker-compose.yml</code> so they can be run together in an isolated environment. It get an app running in one command by just running <code>docker-compose up</code>.<p><strong>Docker compose</strong> uses the <code>Dockerfile</code> if one add the build command to your project’s <code>docker-compose.yml</code>. Your Docker workflow should be to build a suitable <code>Dockerfile</code> for each image you wish to create, then use compose to assemble the images using the build command.<p>We will create a demo: simple app nodejs using Redis. You will see the problem with only <strong>Dockerfile</strong> and why use <strong>Docker compose</strong>.<h2 id=project-demo>Project demo<a aria-label="Anchor link for: project-demo" class=zola-anchor href=#project-demo style=visibility:hidden>#</a></h2><h3 id=installation>Installation<a aria-label="Anchor link for: installation" class=zola-anchor href=#installation style=visibility:hidden>#</a></h3><p>Make sure you have docker & docker-compose installed in your machine:<ul><li><a rel="nofollow noreferrer" href=https://docs.docker.com/get-docker/>How to install docker</a><li><a rel="nofollow noreferrer" href=https://docs.docker.com/compose/install/>How to install docker-compose</a></ul><h3 id=create-docker-images-without-docker-compose>Create Docker Images without Docker compose<a aria-label="Anchor link for: create-docker-images-without-docker-compose" class=zola-anchor href=#create-docker-images-without-docker-compose style=visibility:hidden>#</a></h3><ul><li><p>Create project folder</p> <pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#282a36><code class=language-bash data-lang=bash><span style=color:#50fa7b>$</span><span> mkdir node-redis-demo
</span><span style=color:#50fa7b>$</span><span> cd node-redis-demo
</span></code></pre><li><p>Create <code>package.json</code> file</p> <p>In this file, we will declare the dependencies we use for our application. This step is similar as you create the Nodejs application (without <strong>npm install</strong> or <strong>yarn add</strong> dependencies).</p> <p>We consider our computer don't have <strong>npm</strong> or <strong>yarn</strong> installed. We just use Docker to create the develop environment.</p> <pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#282a36><code class=language-bash data-lang=bash><span style=color:#50fa7b>$</span><span> touch package.json </span><span style=color:#6272a4># or yarn init -y
</span></code></pre> <p>Paste the following code:</p> <pre class=language-javascript data-lang=javascript style=color:#f8f8f2;background-color:#282a36><code class=language-javascript data-lang=javascript><span style=color:#6272a4>//package.json
</span><span>  {
</span><span>  </span><span style=color:#f1fa8c>"name"</span><span>: </span><span style=color:#f1fa8c>"node-redis-app"</span><span>,
</span><span>  </span><span style=color:#f1fa8c>"version"</span><span>: </span><span style=color:#f1fa8c>"1.0.0"</span><span>,
</span><span>  </span><span style=color:#f1fa8c>"main"</span><span>: </span><span style=color:#f1fa8c>"index.js"</span><span>,
</span><span>  </span><span style=color:#f1fa8c>"license"</span><span>: </span><span style=color:#f1fa8c>"MIT"</span><span>,
</span><span>  </span><span style=color:#f1fa8c>"scripts"</span><span>: {
</span><span>    </span><span style=color:#f1fa8c>"start"</span><span>: </span><span style=color:#f1fa8c>"node index.js"</span><span>,
</span><span>  },
</span><span>  </span><span style=color:#f1fa8c>"dependencies"</span><span>: {
</span><span>    </span><span style=color:#f1fa8c>"redis"</span><span>: </span><span style=color:#f1fa8c>"*"</span><span>, </span><span style=color:#6272a4>//We don't care about the version of dependencies
</span><span>    </span><span style=color:#f1fa8c>"express"</span><span>: </span><span style=color:#f1fa8c>"*"</span><span>, </span><span style=color:#6272a4>//Docker will fetch the latest version of them
</span><span>  }
</span><span>}
</span></code></pre><li><p>Create <code>index.js</code> file to config <code>express</code> and run server</p> <pre class=language-javascript data-lang=javascript style=color:#f8f8f2;background-color:#282a36><code class=language-javascript data-lang=javascript><span style=color:#6272a4>//index.js
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>express </span><span style=color:#ff79c6>= </span><span style=color:#8be9fd>require</span><span>(</span><span style=color:#f1fa8c>'express'</span><span>);
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>redis </span><span style=color:#ff79c6>= </span><span style=color:#8be9fd>require</span><span>(</span><span style=color:#f1fa8c>'redis'</span><span>);
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>app </span><span style=color:#ff79c6>= </span><span style=color:#50fa7b>express</span><span>();
</span><span>
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>client </span><span style=color:#ff79c6>= </span><span style=color:#fff>redis</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>createClient</span><span>();
</span><span style=color:#fff>client</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>on</span><span>(</span><span style=color:#f1fa8c>'error'</span><span>, </span><span style=color:#8be9fd;font-style:italic>function </span><span>(</span><span style=color:#ffb86c;font-style:italic>error</span><span>) {
</span><span>  </span><span style=color:#66d9ef;font-style:italic>console</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>error</span><span>(</span><span style=color:#fff>error</span><span>);
</span><span>});
</span><span style=color:#fff>client</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>set</span><span>(</span><span style=color:#f1fa8c>'visits'</span><span>, </span><span style=color:#bd93f9>0</span><span>);
</span><span>
</span><span style=color:#fff>app</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>get</span><span>(</span><span style=color:#f1fa8c>'/'</span><span>, (</span><span style=color:#ffb86c;font-style:italic>req</span><span>, </span><span style=color:#ffb86c;font-style:italic>res</span><span>) </span><span style=color:#8be9fd;font-style:italic>=> </span><span>{
</span><span>  </span><span style=color:#fff>client</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>get</span><span>(</span><span style=color:#f1fa8c>'visits'</span><span>, (</span><span style=color:#ffb86c;font-style:italic>err</span><span>, </span><span style=color:#ffb86c;font-style:italic>visits</span><span>) </span><span style=color:#8be9fd;font-style:italic>=> </span><span>{
</span><span>    </span><span style=color:#fff>res</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>send</span><span>(</span><span style=color:#f1fa8c>'Number of visits is ' </span><span style=color:#ff79c6>+ </span><span style=color:#fff>visits</span><span>);
</span><span>    </span><span style=color:#fff>client</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>set</span><span>(</span><span style=color:#f1fa8c>'visits'</span><span>, </span><span style=color:#8be9fd>parseInt</span><span>(</span><span style=color:#fff>visits</span><span>) </span><span style=color:#ff79c6>+ </span><span style=color:#bd93f9>1</span><span>);
</span><span>  });
</span><span>});
</span><span>
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>port </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>8080</span><span>;
</span><span style=color:#fff>app</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>listen</span><span>(</span><span style=color:#fff>port</span><span>, () </span><span style=color:#8be9fd;font-style:italic>=> </span><span>{
</span><span>  </span><span style=color:#66d9ef;font-style:italic>console</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>log</span><span>(</span><span style=color:#f1fa8c>'App Redis is running on port 8080'</span><span>);
</span><span>});
</span><span>
</span><span style=color:#8be9fd;font-style:italic>const 
</span></code></pre><li><p>Create <strong>Dockerfile</strong></p> <pre class=language-yml data-lang=yml style=color:#f8f8f2;background-color:#282a36><code class=language-yml data-lang=yml><span style=color:#6272a4># Dockerfile
</span><span style=color:#f1fa8c>FROM node:12.18-alpine </span><span style=color:#6272a4>#Version nodejs we want to use
</span><span>
</span><span style=color:#f1fa8c>WORKDIR /app </span><span style=color:#6272a4>#Define the work directory of project in Docker container
</span><span>
</span><span style=color:#f1fa8c>COPY package*.json ./ </span><span style=color:#6272a4>#Make sure always copy package.json and package-lock.json to build folder
</span><span style=color:#6272a4># Copy package.json to avoid reinstall all the dependencies for each build
</span><span>
</span><span style=color:#f1fa8c>RUN yarn install </span><span style=color:#6272a4>#Run install and update dependencies from package.json
</span><span>
</span><span style=color:#f1fa8c>COPY . . </span><span style=color:#6272a4>#Copy all other files to the build folder
</span><span>
</span><span style=color:#f1fa8c>EXPOSE 8080 </span><span style=color:#6272a4>#Optional: Port running on Docker container
</span><span style=color:#f1fa8c>CMD ["node", "index.js"] </span><span style=color:#6272a4>#Command line to run project
</span><span>
</span></code></pre> <p>You can also check an article on my blog for more information of Dockerfile: <a rel="nofollow noreferrer" href=https://tduyng.github.io/blog/create-simple-project-nodejs-with-docker>Create simple project Nodejs with Docker</a></p><li><p>Create <code>.dockerignore</code></p> <pre class=language-yml data-lang=yml style=color:#f8f8f2;background-color:#282a36><code class=language-yml data-lang=yml><span style=color:#f1fa8c>node_modules
</span><span style=color:#f1fa8c>npm-debug.log
</span><span style=color:#f1fa8c>yarn-debug.log
</span></code></pre><li><p>Build Docker Image OK, everything is done. Now, we will build this image:</p> <pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#282a36><code class=language-bash data-lang=bash><span style=color:#50fa7b>$</span><span> docker build</span><span style=color:#ffb86c;font-style:italic> -t</span><span> node-redis-app .
</span></code></pre> <p>Don't forget the point <strong>.</strong> in the end.</p> <p>You can check all images available in your computer:</p> <pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#282a36><code class=language-bash data-lang=bash><span style=color:#50fa7b>$</span><span> docker images
</span></code></pre><li><p>Run Docker container from Docker image We have already an Docker image node-redis-app. The thing to do now is run container from this image to start project.</p> <pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#282a36><code class=language-bash data-lang=bash><span style=color:#50fa7b>$</span><span> docker run</span><span style=color:#ffb86c;font-style:italic> -p</span><span> 8080:8080</span><span style=color:#ffb86c;font-style:italic> -it</span><span> node-redis-app
</span></code></pre> <p><strong>-p 8080:8080</strong> flag: declare port using (port on Docker container and port on your machine) <strong>-it</strong> flag: allow access inside the terminal of Docker container <strong>node-redis-app</strong>: name image of your app</p><li><p>Problem When you run with the command above, you will see an error failed connection with Redis-server:</p> <pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#282a36><code class=language-bash data-lang=bash><span style=color:#50fa7b>$</span><span> docker run</span><span style=color:#ffb86c;font-style:italic> -p</span><span> 8080:8080</span><span style=color:#ffb86c;font-style:italic> -it</span><span> node-redis-app
</span><span>
</span><span style=color:#50fa7b>App</span><span> Redis is running on port 8080
</span><span style=color:#50fa7b>Error:</span><span> Redis connection to 127.0.0.1:6379 failed - connect ECONNREFUSED 127.0.0.1:6379
</span><span>    </span><span style=color:#50fa7b>at</span><span> TCPConnectWrap.afterConnect </span><span style=color:#ff79c6>[</span><span>as oncomplete</span><span style=color:#ff79c6>]</span><span> (net.js:1141:16) {
</span><span>  </span><span style=color:#50fa7b>errno: </span><span style=color:#f1fa8c>'ECONNREFUSED'</span><span>,
</span><span>  </span><span style=color:#50fa7b>code: </span><span style=color:#f1fa8c>'ECONNREFUSED'</span><span>,
</span><span>  </span><span style=color:#50fa7b>syscall: </span><span style=color:#f1fa8c>'connect'</span><span>,
</span><span>  </span><span style=color:#50fa7b>address: </span><span style=color:#f1fa8c>'127.0.0.1'</span><span>,
</span><span>  </span><span style=color:#50fa7b>port:</span><span> 6379
</span><span>}
</span><span>
</span></code></pre> <p><strong>What is the problem ?</strong> The problem is: You want to run 2 containers in same times. ==> <strong>redis-server</strong> && <strong>nodejs</strong> But when you run your Dockerfile, you run only Nodejs app container, not to redis container. You can also create other redis-server container from <a rel="nofollow noreferrer" href=https://hub.docker.com/_/redis>redis</a> image</p> <p>There are no any link between 2 this containers. Your Nodejs application can't connect to <strong>redis-server</strong>(from <strong>redis</strong> Docker image).</p> <p><strong>How to resolve this error?</strong> The answer is <strong>Docker compose</strong>. In this case, we need to use Docker compose to run and connect multiple Docker container.</p></ul><h3 id=create-docker-image-using-docker-compose>Create Docker image using Docker compose<a aria-label="Anchor link for: create-docker-image-using-docker-compose" class=zola-anchor href=#create-docker-image-using-docker-compose style=visibility:hidden>#</a></h3><ul><li><p>To make sure the project above running, we need simply create a <code>docker-compose.yml</code> file. It is a config file for docker-compose. It allows us to define the services (container) using in our app.</p> <pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#282a36><code class=language-bash data-lang=bash><span style=color:#50fa7b>$</span><span> touch docker-compose.yml
</span></code></pre><li><p>Add the following code:</p> <pre class=language-yml data-lang=yml style=color:#f8f8f2;background-color:#282a36><code class=language-yml data-lang=yml><span style=color:#ff79c6>version</span><span>: </span><span style=color:#f1fa8c>'3.8' </span><span style=color:#6272a4>#version of docker-compose
</span><span style=color:#ff79c6>services</span><span>: </span><span style=color:#6272a4># declare containers used
</span><span>  </span><span style=color:#ff79c6>redis-server</span><span>: </span><span style=color:#6272a4>#image of redis
</span><span>    </span><span style=color:#ff79c6>image</span><span>: </span><span style=color:#f1fa8c>'redis'
</span><span>  </span><span style=color:#ff79c6>node-app</span><span>: </span><span style=color:#6272a4>#images of your node app (using Dockerfile, package.json ...)
</span><span>    </span><span style=color:#ff79c6>restart</span><span>: </span><span style=color:#f1fa8c>always </span><span style=color:#6272a4>#If this container stops for any reason, always attempt to restart it
</span><span>    </span><span style=color:#ff79c6>build</span><span>: </span><span style=color:#bd93f9>.
</span><span>    </span><span style=color:#ff79c6>ports</span><span>:
</span><span>      - </span><span style=color:#f1fa8c>'8080:8080'
</span><span>
</span></code></pre> <p>Check <a rel="nofollow noreferrer" href=https://docs.docker.com/compose/gettingstarted/>docker compose</a> for more details about configuration.</p><li><p>Update redis services to <code>index.js</code> file</p> <pre class=language-javascript data-lang=javascript style=color:#f8f8f2;background-color:#282a36><code class=language-javascript data-lang=javascript><span style=color:#6272a4>// index.js
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>express </span><span style=color:#ff79c6>= </span><span style=color:#8be9fd>require</span><span>(</span><span style=color:#f1fa8c>'express'</span><span>);
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>redis </span><span style=color:#ff79c6>= </span><span style=color:#8be9fd>require</span><span>(</span><span style=color:#f1fa8c>'redis'</span><span>);
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>app </span><span style=color:#ff79c6>= </span><span style=color:#50fa7b>express</span><span>();
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>process </span><span style=color:#ff79c6>= </span><span style=color:#8be9fd>require</span><span>(</span><span style=color:#f1fa8c>'process'</span><span>);
</span><span>
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>client </span><span style=color:#ff79c6>= </span><span style=color:#fff>redis</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>createClient</span><span>({
</span><span>  host: </span><span style=color:#f1fa8c>'redis-server'</span><span>,
</span><span>  port: </span><span style=color:#f1fa8c>'6379'</span><span>,
</span><span>});
</span><span style=color:#fff>client</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>on</span><span>(</span><span style=color:#f1fa8c>'error'</span><span>, </span><span style=color:#8be9fd;font-style:italic>function </span><span>(</span><span style=color:#ffb86c;font-style:italic>error</span><span>) {
</span><span>  </span><span style=color:#66d9ef;font-style:italic>console</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>error</span><span>(</span><span style=color:#fff>error</span><span>);
</span><span>});
</span><span style=color:#fff>client</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>set</span><span>(</span><span style=color:#f1fa8c>'visits'</span><span>, </span><span style=color:#bd93f9>0</span><span>);
</span><span>
</span><span style=color:#fff>app</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>get</span><span>(</span><span style=color:#f1fa8c>'/'</span><span>, (</span><span style=color:#ffb86c;font-style:italic>req</span><span>, </span><span style=color:#ffb86c;font-style:italic>res</span><span>) </span><span style=color:#8be9fd;font-style:italic>=> </span><span>{
</span><span>  process</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>exit</span><span>(</span><span style=color:#bd93f9>0</span><span>);
</span><span>  </span><span style=color:#fff>client</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>get</span><span>(</span><span style=color:#f1fa8c>'visits'</span><span>, (</span><span style=color:#ffb86c;font-style:italic>err</span><span>, </span><span style=color:#ffb86c;font-style:italic>visits</span><span>) </span><span style=color:#8be9fd;font-style:italic>=> </span><span>{
</span><span>    </span><span style=color:#fff>res</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>send</span><span>(</span><span style=color:#f1fa8c>'Number of visits is ' </span><span style=color:#ff79c6>+ </span><span style=color:#fff>visits</span><span>);
</span><span>    </span><span style=color:#fff>client</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>set</span><span>(</span><span style=color:#f1fa8c>'visits'</span><span>, </span><span style=color:#8be9fd>parseInt</span><span>(</span><span style=color:#fff>visits</span><span>) </span><span style=color:#ff79c6>+ </span><span style=color:#bd93f9>1</span><span>);
</span><span>  });
</span><span>});
</span><span>
</span><span style=color:#8be9fd;font-style:italic>const </span><span style=color:#fff>port </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>8080</span><span>;
</span><span style=color:#fff>app</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>listen</span><span>(</span><span style=color:#fff>port</span><span>, () </span><span style=color:#8be9fd;font-style:italic>=> </span><span>{
</span><span>  </span><span style=color:#66d9ef;font-style:italic>console</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>log</span><span>(</span><span style=color:#f1fa8c>'App Redis is running on port 8080'</span><span>);
</span><span>});
</span><span>
</span></code></pre><li><p>Build and run your app with docker-compose</p> <p>In the root project:</p> <ul><li>Build images:<pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#282a36><code class=language-bash data-lang=bash><span style=color:#50fa7b>$</span><span> docker-compose build
</span></code></pre> When you use docker-compose to build the image, the image name is always going to be <strong><project>_<service>, where <strong><service> in this example is <strong>node-redis-app_node-app</strong>. <li>Run containers with docker-compose</li> <pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#282a36><code class=language-bash data-lang=bash><span style=color:#50fa7b>$</span><span> docker-compose up </span><span style=color:#6272a4># all services declared in docker-compose.yml will be started
</span><span style=color:#50fa7b>$</span><span> docker-compose up</span><span style=color:#ffb86c;font-style:italic> -d </span><span style=color:#6272a4>#detach mode
</span></code></pre> <ul><li>Stop containers with docker-compose</ul> <pre class=language-bash data-lang=bash style=color:#f8f8f2;background-color:#282a36><code class=language-bash data-lang=bash><span style=color:#50fa7b>$</span><span> docker-compose down </span><span style=color:#6272a4># Stop all containers declared in docker-compose.yml file
</span></code></pre> <p>That's it. Test the code on your machine and check it in then <a rel="nofollow noreferrer" href=http://localhost:8080>localhost8080</a> to see the result.</p> <h2 id=resume>Resume<a aria-label="Anchor link for: resume" class=zola-anchor href=#resume style=visibility:hidden>#</a></h2> <p>Docker compose:</p> <ul><li>Separate CLI that gets installed along with Docker<li>Used to startup multiple Docker containers at the same time<li>Automate some of the long-winded arguments we were passing to <code>docker run</code><li><strong>Docker compose</strong> will start and connect all the containers Docker that you declare in the <code>docker-compose.yml</code> file. We will use it usually when we work with Docker.</ul> <h2 id=reference>Reference<a aria-label="Anchor link for: reference" class=zola-anchor href=#reference style=visibility:hidden>#</a></h2> <ul><li><a rel="nofollow noreferrer" href=https://github.com/tduyng/try-docker/tree/master/01.dive-into-docker/simple-with-redis>Code demo GitHub</a><li><a rel="nofollow noreferrer" href=https://tduyng.github.io/blog/create-simple-project-nodejs-with-docker>Previous post: create simple Nodejs app with Docker</a><li><a rel="nofollow noreferrer" href=https://docs.docker.com/>Docker official</a><li><a rel="nofollow noreferrer" href=https://docs.docker.com/compose/>Learn about <strong>Docker compose</strong></a><li><a rel="nofollow noreferrer" href=https://jstobigdata.com/docker-compose-cheatsheet/>Docker compose cheatsheet</a></ul> <div class=pagination><div class=pagination__buttons><span class="button previous"> <a href=https://tduyng2.github.io/blog/create-simple-project-nodejs-with-docker/> <span class=button__icon>←</span>  <span class=button__text>Create simple web app Nodejs with Docker</span> </a> </span><span class="button next"> <a href=https://tduyng2.github.io/blog/start-a-new-journey/> <span class=button__text>Start a new journey</span>  <span class=button__icon>→</span> </a> </span></div></div> <div class=giscus></div> <script data-repo-id="MDEwOlJlcG9zaXRvcnkyNjAzNTM0NzM=" async crossorigin data-category=General data-category-id=DIC_kwDOD4Stwc4CfSpo data-dark-theme=noborder_dark data-emit-metadata=0 data-input-position=bottom data-lang=en data-lazy-loading=true data-light-theme=noborder_light data-mapping=specific data-reactions-enabled=1 data-repo=tduyng/tduyng.github.io data-strict=1 data-term=why-use-dockercompose src=https://giscus.app/client.js></script> <footer><div class=copyright><p>© 2024 Duy NG</div><a class="instant fold" href=/tags>tags</a><a class="instant fold" href=/subscribe>subscribe</a><a class="instant fold" href=/contact>contact</a><a class="instant fold" href=/privacy>privacy</a><a class="instant fold" href=/sitemap.xml>sitemap</a><a class="instant fold" href=/atom.xml>rss</a></footer> <script src=/js/lightense.min.js></script> <script src=/js/main.js></script> 